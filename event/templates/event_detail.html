{% extends "shop/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{{ event.title }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/event_detail.css' %}">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<style>
      #map {height: 100%; width: 100%;}
</style>
{% endblock %}

{% block content %}
<div class="event-detail-container">
    <!-- Event Header -->
    <div class="event-header">
        <div class="event-breadcrumb">
            <a href="{% url 'events:event_list' %}">{% trans "Events" %}</a>
            <span> / </span>
            <span>{{ event.title }}</span>
        </div>

        <div class="event-meta">
                <span class="event-date">ğŸ“… {{ event.created|date:"Y-m-d" }}</span>
            <span class="event-location">ğŸ“ {{ location.location_name }}</span>
        </div>
    </div>

    <!-- Event Hero -->
    <div class="event-hero">
        <div class="event-image">
            {% if event.image %}
                <img src="{{ event.image.url }}" alt="{{ event.title }}">
            {% else %}
                <div class="event-image-placeholder">
                    <span>ğŸŒ¸</span>
                </div>
            {% endif %}
            <div class="event-badge">
                {% if event.is_upcoming %}
                    <span class="badge upcoming">ğŸ”œ {% trans "Upcoming" %}</span>
                {% elif event.is_ongoing %}
                    <span class="badge ongoing">ğŸ¯ {% trans "Ongoing" %}</span>
                {% else %}
                    <span class="badge past">âœ… {% trans "Completed" %}</span>
                {% endif %}
            </div>
        </div>

        <div class="event-hero-content">
            <h1 class="event-title">{{ event.title }}</h1>
            <p class="event-excerpt">{{ event.excerpt }}</p>

            <div class="event-actions">
                <!---/>
                <button class="btn-primary wave-btn" id="register-btn">
                    <span>ğŸŸï¸ {% trans "Register Now" %}</span>
                </button>
                <--->
                <button class="btn-secondary" id="share-btn">
                    ğŸ“¤ {% trans "Share" %}
                </button>
                <!--/>
                <button class="btn-wishlist" id="wishlist-btn">
                    â¤ï¸ {% trans "Save" %}
                </button>
                <--->
            </div>
        </div>
    </div>

    <!-- Event Content -->
    <div class="event-content">
        <div class="event-main">
            <div class="event-description">
                <h2>ğŸ“– {% trans "About this Event" %}</h2>
                <div class="description-content">
                    {{ event.description|linebreaks }}
                </div>
            </div>

            {% if event.highlights %}
            <div class="event-highlights">
                <h2>âœ¨ {% trans "Event Highlights" %}</h2>
                <ul class="highlight-list">
                    {% for highlight in event.highlights_list %}
                    <li class="highlight-item">
                        <span class="highlight-icon">ğŸŒŸ</span>
                        {{ highlight }}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if event.speakers %}
            <div class="event-speakers">
                <h2>ğŸ¤ {% trans "Featured Speakers" %}</h2>
                <div class="speakers-grid">
                    {% for speaker in event.speakers_list %}
                    <div class="speaker-card">
                        <div class="speaker-avatar">
                            <span>ğŸ‘¤</span>
                        </div>
                        <div class="speaker-info">
                            <h4>{{ speaker.name }}</h4>
                            <p>{{ speaker.role }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Event Sidebar -->
        <aside class="event-sidebar">
            <div class="sidebar-card">
                <h3>ğŸ“‹ {% trans "Event Details" %}</h3>
                <div class="detail-item">
                    <span class="detail-label">ğŸ“… {% trans "Date" %}:</span>
                    {% if event.finish_event %}
                        <span class="detail-value">{{ event.start_event|date:"M d, Y" }}-{{ event.finish_event|date:"M d, Y" }}</span>
                    {% else %}
                        <span class="detail-value">{{ event.start_event|date:"M d, Y" }}</span>
                    {% endif %}
                </div>
                <div class="detail-item">
                    <span class="detail-label">â° {% trans "Time" %}:</span>
                    {% if event.finish_event %}
                        <span class="detail-value">{{ event.start_event|time:"H:i" }}-{{ event.finish_event|time:"H:i" }}</span>
                    {% else %}
                        <span class="detail-value">{{ event.start_event|time:"H:i" }}</span>
                    {% endif %}


                </div>
                <div class="detail-item">
                    <span class="detail-label">ğŸ“ {% trans "Location" %}:</span>
                    <span class="detail-value">{{ location.location_name }}</span>
                </div>
                <!--/>
                <div class="detail-item">
                    <span class="detail-label">ğŸŸï¸ {% trans "Seats" %}:</span>
                    <span class="detail-value">{{ event.available_seats }} {% trans "available" %}</span>
                </div>
                <--->
                {% if event.price >= 0 %}
                    <div class="detail-item">
                            <span class="detail-label">ğŸ’° {% trans "Price" %}:</span>
                            <span class="detail-value">
                                {% if event.price > 0 %}
                                    ${{ event.price }}
                                {% else %}
                                    {% trans "Free" %}
                                {% endif %}
                            </span>
                    </div>
                {% endif %}
            </div>
            <!---/>
            <div class="sidebar-card">
                <h3>ğŸ“ {% trans "Contact Info" %}</h3>
                <div class="contact-item">
                    <span class="contact-icon">ğŸ“§</span>
                    <span>{{ event.contact_email }}</span>
                </div>
                <div class="contact-item">
                    <span class="contact-icon">ğŸ“±</span>
                    <span>{{ event.contact_phone }}</span>
                </div>
            </div>
            <--->

            <div class="sidebar-card">
                <h3>ğŸ—ºï¸ {% trans "Location Map" %}</h3>
                <div class="map-placeholder" id="event-map">
                    <div id="map"></div>
                    <script defer src="{% static 'js/map.js' %}"></script>
                </div>
            </div>
        </aside>
    </div>

    <!-- Related Events -->
    {% if related_events %}
    <div class="related-events">
        <h2>ğŸª {% trans "You might also like" %}</h2>
        <div class="related-events-grid">
            {% for related_event in related_events %}
            <div class="related-event-card">
                <div class="related-event-image">
                    {% if related_event.image %}
                        <img src="{{ related_event.image.url }}" alt="{{ related_event.title }}">
                    {% else %}
                        <span>ğŸŒ¸</span>
                    {% endif %}
                </div>
                <div class="related-event-content">
                    <h4>{{ related_event.title }}</h4>
                    <p>{{ related_event.date|date:"M d, Y" }}</p>
                    <a href="{{ related_event.get_absolute_url }}" class="btn-link">
                        {% trans "View Details" %} â†’
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Registration Modal -->
    <div class="modal" id="registration-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>ğŸŸï¸ {% trans "Register for Event" %}</h2>
            <form id="registration-form" class="registration-form">
                <div class="form-group">
                    <label for="name">{% trans "Full Name" %}</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">{% trans "Email" %}</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">{% trans "Phone Number" %}</label>
                    <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group">
                    <label for="guests">{% trans "Number of Guests" %}</label>
                    <select id="guests" name="guests">
                        <option value="1">1 {% trans "person" %}</option>
                        <option value="2">2 {% trans "people" %}</option>
                        <option value="3">3 {% trans "people" %}</option>
                        <option value="4">4 {% trans "people" %}</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">
                    ğŸ“ {% trans "Complete Registration" %}
                </button>
            </form>
        </div>
    </div>
</div>

<input type="hidden" id="location_name" name="location_name" value="{{ location.location_name }}">
<input type="hidden" id="latitude" name="latitude" value="{{ location.lat_position }}">
<input type="hidden" id="long" name="long" value="{{ location.long_position }}">
{% endblock %}

{% block extra_script %}
<script src="{% static 'js/event_detail.js' %}"></script>
{% endblock %}